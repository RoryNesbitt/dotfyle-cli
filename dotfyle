#!/usr/bin/env sh

is_ignored() {
  found=false
  case "$1" in
    *"." | *".." | *"*" | *".git")
      found=true
      return
      ;;
  esac
  $found
}

find_init() {
  path="$1"
  if ls "$path"/init.lua 1> /dev/null 2>&1 \
  || ls "$path"/init.vim 1> /dev/null 2>&1; then
    path=${path#"$HOME/.config/dotfyle/"}
    echo "$path"
  else
    for x in "*" ".*"; do
      for pathname in "$path/"$x; do
        if is_ignored "$pathname"; then
          continue # skip these directories
        elif [ -d "$pathname" ]; then
          find_init "$pathname"
        fi
      done
    done
  fi
}

select_config() {
  find_init "$HOME/.config/dotfyle" | fzf --prompt="Config: " --preview="cat $HOME/.config/dotfyle/{}/init.*" --preview-window=right:70%:wrap --bind=ctrl-f:page-down,ctrl-b:page-up --height=100% --border
}

run() {
  appname="dotfyle/$(select_config)"
  NVIM_APPNAME="$appname" nvim
}

run
