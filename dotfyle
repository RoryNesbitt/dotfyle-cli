#!/usr/bin/env sh

dir_name="dotfyle"

is_ignored() {
  found=false
  case "$1" in
    *"." | *".." | *"*" | *".git")
      found=true
      return
      ;;
  esac
  $found
}

find_init() {
  if ls "$1"/init.lua 1> /dev/null 2>&1 \
  || ls "$1"/init.vim 1> /dev/null 2>&1; then
    path=${1#"$HOME/.config/$dir_name/"}
    echo "$path"
  else
    for x in "*" ".*"; do
      for pathname in "$1/"$x; do
        if is_ignored "$pathname"; then
          continue # skip these directories
        elif [ -d "$pathname" ]; then
          find_init "$pathname"
        fi
      done
    done
  fi
}

select_config() {
  find_init "$HOME/.config/$dir_name" | fzf --prompt="Config: " --preview="cat $HOME/.config/$dir_name/{}/init.*" --preview-window=right:70%:wrap --bind=ctrl-f:page-down,ctrl-b:page-up --height=100% --border
}

run() {
  appname="$(select_config)"
  if [ -n "$appname" ]; then
    NVIM_APPNAME="$dir_name/$appname" nvim
  fi
}

purge() {
  rm -rf "$HOME/.config/$dir_name/$1"
  rm -rf "$HOME/.cache/$dir_name/$1"
  rm -rf "$HOME/.local/share/$dir_name/$1"
  rm -rf "$HOME/.local/state/$dir_name/$1"
}

remove() {
  appname="$(select_config)"
  if [ -n "$appname" ]; then
    purge "$appname"
  fi
}

# find_init "$HOME/.config/$dir_name"
run
