#!/usr/bin/env sh

is_ignored() {
  found=false
  case "$1" in
    *"." | *".." | *"*" | *".git")
      found=true
      return
      ;;
  esac
  $found
}

find_init() {
  if ls "$1"/init.lua 1> /dev/null 2>&1 \
  || ls "$1"/init.vim 1> /dev/null 2>&1; then
    path=${1#"$HOME/.config/dotfyle/"}
    echo "$path"
  else
    for x in "*" ".*"; do
      for pathname in "$1/"$x; do
        if is_ignored "$pathname"; then
          continue # skip these directories
        elif [ -d "$pathname" ]; then
          find_init "$pathname"
        fi
      done
    done
  fi
}

select_config() {
  find_init "$HOME/.config/dotfyle" | fzf --prompt="Config: " --preview="cat $HOME/.config/dotfyle/{}/init.*" --preview-window=right:70%:wrap --bind=ctrl-f:page-down,ctrl-b:page-up --height=100% --border
}

run() {
  appname="$(select_config)"
  if [ -n "$appname" ]; then
    NVIM_APPNAME="dotfyle/$appname" nvim
  fi
}

# find_init "$HOME/.config/dotfyle"
run
